<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notification</title>
    <link rel="stylesheet" href="../css/general.css" />
    <link rel="stylesheet" href="../css/notif.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>

  <body>
    <div class="container">
      <!-- Sidebar -->
      <%- include("./includes/sidebar") %>

      <!-- Main Content -->
      <div class="main-content">
        <div class="fix">
          <h1>Notification</h1>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Name</th>
                <th>RFID tag</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <!-- Dynamic content will be injected here -->
            </tbody>
          </table>
        </div>

        <!-- Side Panel -->
        <div id="side-panel" class="side-panel hidden">
          <h3>Information</h3>
          <div class="info">
            <h4>
              <strong
                >Notified from the College of Engineering than an item is
                outside the Smartzone</strong
              >
            </h4>
            <h4>All details are written below:</h4>
          </div>
          <hr />
          <div class="details">
            <p><strong>Accountable:</strong> Carlota Salas</p>
            <p>
              <strong>Name of Item:</strong> Electric Power and Transmission
            </p>
            <p><strong>Location:</strong> College of Engineering</p>
            <p>
              <strong>Department/Office:</strong> Computer Engineering (BSCpE)
            </p>
            <p><strong>Status:</strong> Outside 10/15/24 @ 8:09 am</p>
            <p><strong>UACS Code:</strong> 213781274838948326HGDS</p>
          </div>
          <hr />
          <p>
            <strong>Description: (Location where the property is)</strong>
            Faculty >> Room 218 >> Room 209
          </p>
          <button id="close-panel">Close</button>
        </div>

        <!-- Overlay -->
        <div id="overlay" class="overlay"></div>
      </div>
    </div>
    <script src="../js/notif.js"></script>

    <script>
      function refreshTable() {
        fetch("/notif/notif")
          .then((response) => response.text())
          .then((data) => {
            const tableBody = document.querySelector(".table-container tbody");
            tableBody.innerHTML += data;
          })
          .catch((error) => console.error("Error refreshing table:", error));
      }

      // Parent element selector
      const tableBody = document.querySelector(".table-container tbody");
      const sidePanel = document.getElementById("side-panel");
      const closePanelButton = document.getElementById("close-panel");
      const overlay = document.getElementById("overlay");

      // Event delegation for .notification-item clicks
      tableBody.addEventListener("click", (event) => {
        const target = event.target.closest(".notification-item");
        if (target) {
          console.log("Notification clicked:", target.dataset.id); // For debugging
          // Display the panel
          sidePanel.classList.add("visible");
          sidePanel.classList.remove("hidden");
          overlay.classList.add("visible");
        }
      });

      // Close Side Panel
      closePanelButton.addEventListener("click", () => {
        // Hide the panel
        sidePanel.classList.remove("visible");
        sidePanel.classList.add("hidden");
        overlay.classList.remove("visible");
      });

      // Refresh the table every second
      setInterval(refreshTable, 1000);
    </script>

    <!-- Linking JavaScript -->
  </body>
</html>

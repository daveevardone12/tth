<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAR Form | Property Management System</title>
    <link rel="stylesheet" href="../css/general.css">
    <link rel="stylesheet" href="../css/parstyle.css">
</head>

<body>

    <%- include("./includes/sidebar.ejs") %>

        <% if (messages.success) { %>
            <script>
                alert("<%= messages.success %>");
            </script>
            <% } %>
                <% if (messages.error) { %>
                    <script>
                        alert("<%= messages.error %>");
                    </script>
                    <% } %>
                        <div class="main-content">
                            <div class="form-containers">
                                <h1>Property Acknowledgement Receipt</h1>
                                <form method="POST" action="/par/save">
                                    <h2>Item Details</h2>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="itemName">Name of Item *</label>
                                            <input type="text" id="itemName" name="itemName"
                                                placeholder="Ex. Portable Controlled Learning System" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="accountable">Accountable *</label>
                                            <input type="text" id="accountable" name="accountable"
                                                placeholder="Ex. Carlos A. Santos" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="cost">Unit Cost/Value *</label>
                                            <input type="number" id="cost" name="cost" placeholder="Ex. 30,000.00"
                                                required>
                                        </div>
                                        <div class="form-group">
                                            <label for="dateAcquired">Date Acquired *</label>
                                            <input type="date" id="dateAcquired" name="dateAcquired"
                                                placeholder="Ex. 3/18/2019" required>
                                        </div>

                                        <div class="form-group">
                                            <label for="location">Location *</label>
                                            <div class="custom-dropdown">
                                                <div class="custom-dropdown-trigger" id="location-dropdown-trigger">
                                                    Select Location
                                                </div>
                                                <div class="custom-dropdown-options" id="location">
                                                    <div class="custom-dropdown-option" data-value="College of Engineering">College of Engineering</div>
                                                    <div class="custom-dropdown-option" data-value="Smart Center">Smart Center</div>
                                                    <div class="custom-dropdown-option" data-value="Library">Library</div>
                                                    <div class="custom-dropdown-option" data-cancel="true">Cancel Selection</div>
                                                </div>
                                            </div>
                                            <input type="hidden" name="location" id="location-value" value="Default Location">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="category">Category *</label>
                                            <div class="custom-dropdown">
                                                <div class="custom-dropdown-trigger" id="category-dropdown-trigger">
                                                    Select Category
                                                </div>
                                                <div class="custom-dropdown-options" id="category">
                                                    <div class="custom-dropdown-option" data-value="Furnitures">Furnitures</div>
                                                    <div class="custom-dropdown-option" data-value="Appliances">Appliances</div>
                                                    <div class="custom-dropdown-option" data-value="Electronics">Electronics</div>
                                                    <div class="custom-dropdown-option" data-cancel="true">Cancel Selection</div>
                                                </div>
                                            </div>
                                            <input type="hidden" name="category" id="category-value" value="Default Category">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="uacs">UACS Code *</label>
                                            <div class="custom-dropdown">
                                                <div class="custom-dropdown-trigger" id="uacs-dropdown-trigger">
                                                    Select UACS
                                                </div>
                                                <div class="custom-dropdown-options" id="uacs">
                                                    <div class="custom-dropdown-option" data-value="Machinery #1060501000">Machinery #1060501000</div>
                                                    <div class="custom-dropdown-option" data-value="Office Equipment #1060502000">Office Equipment #1060502000</div>
                                                    <div class="custom-dropdown-option" data-value="Agricultural Equipment #1060503000">Agricultural Equipment #1060503000</div>
                                                    <div class="custom-dropdown-option" data-value="Medical Equipment #1060511000">Medical Equipment #1060511000</div>
                                                    <div class="custom-dropdown-option" data-value="Printing Equipment #1060512000">Printing Equipment #1060512000</div>
                                                    <div class="custom-dropdown-option" data-value="Technical and Scientific Equipment #1060514000">Technical and Scientific Equipment #1060514000</div>
                                                    <div class="custom-dropdown-option" data-value="Other Machinery and Equipment #10605990000">Other Machinery and Equipment #10605990000</div>
                                                    <div class="custom-dropdown-option" data-value="Motor Vehicles #1060601000">Motor Vehicles #1060601000</div>
                                                    <div class="custom-dropdown-option" data-value="Furniture and Fixtures #1060701000">Furniture and Fixtures #1060701000</div>
                                                    <div class="custom-dropdown-option" data-value="Books #1060702000">Books #1060702000</div>
                                                    <div class="custom-dropdown-option" data-value="Software #1080102000">Software #1080102000</div>
                                                    <div class="custom-dropdown-option" data-value="Information and Communication Technology Equipment #1060501000">
                                                        Information and Communication Technology Equipment #1060501000
                                                    </div>
                                                    <div class="custom-dropdown-option" data-cancel="true">Cancel Selection</div>
                                                </div>
                                            </div>
                                            <input type="hidden" name="uacs" id="uacs-value" value="Default UACS">
                                        </div>
                                        
                                        <script>
                                        document.addEventListener("DOMContentLoaded", function () {
                                            function setupDropdown(triggerId, optionsId, hiddenInputId, defaultText) {
                                                const trigger = document.getElementById(triggerId);
                                                const options = document.getElementById(optionsId);
                                                const hiddenInput = document.getElementById(hiddenInputId);
                                        
                                                trigger.addEventListener("click", function () {
                                                    options.style.display = options.style.display === "block" ? "none" : "block";
                                                });
                                        
                                                options.addEventListener("click", function (event) {
                                                    const clickedOption = event.target;
                                                    if (clickedOption.classList.contains("custom-dropdown-option")) {
                                                        const isCancel = clickedOption.getAttribute("data-cancel") === "true";
                                                        if (isCancel) {
                                                            trigger.textContent = defaultText;
                                                            hiddenInput.value = defaultText; // Reset hidden input to default
                                                        } else {
                                                            trigger.textContent = clickedOption.textContent;
                                                            hiddenInput.value = clickedOption.getAttribute("data-value"); // Update hidden input with selected value
                                                        }
                                                        options.style.display = "none";
                                                    }
                                                });
                                            }
                                        
                                            setupDropdown("location-dropdown-trigger", "location", "location-value", "Default Location");
                                            setupDropdown("category-dropdown-trigger", "category", "category-value", "Default Category");
                                            setupDropdown("uacs-dropdown-trigger", "uacs", "uacs-value", "Default UACS");
                                        
                                            // Close dropdowns when clicking outside
                                            window.addEventListener("click", function (event) {
                                                if (!event.target.closest(".custom-dropdown")) {
                                                    document.querySelectorAll(".custom-dropdown-options").forEach(function (dropdown) {
                                                        dropdown.style.display = "none";
                                                    });
                                                }
                                            });
                                        });
                                        </script>
                                        

                                        <div class="form-group">
                                            <label for="inventoryNo">Inventory Item No.</label>
                                            <input type="number" name="inventoryNo" id="inventoryNo" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="burs">BURS #</label>
                                            <input type="number" id="burs" name="burs"
                                                placeholder="Ex. 210101-2018-11-1156 11/6/2018" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="life">Estimated Useful Life *</label>
                                            <input type="text or number" id="life" name="estimatedLife" placeholder="N/A"
                                                required>
                                        </div>
                                        <div class="form-group">
                                            <label for="po">PO # *</label>
                                            <input type="text or number" id="po" name="POnumber"
                                                placeholder="Ex. GOODYS-2018-05-A 11/05/18" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="code">Code *</label>
                                            <input type="number" id="code" name="code" placeholder="Ex. 1060054000"
                                                required>
                                        </div>
                                        <div class="form-group">
                                            <label for="iar">IAR *</label>
                                            <input type="number" id="iar" name="IAR"
                                                placeholder="Ex. 2019-ICO-093 3/15/2019" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="supplier">Supplier *</label>
                                            <input type="text" id="supplier" name="supplier"
                                                placeholder="Ex. HYTEC POWER INC." required>
                                        </div>
                                        <div class="form-group">
                                            <label for="serial">Serial No.</label>
                                            <input type="text" id="serial" name="serialNumber" placeholder="Ex. 488320"
                                                required>
                                        </div>
                                        <div class="form-group">
                                            <label for="propertyNo">Property No.</label>
                                            <input type="number" id="propertyNo" name="propertyNumber"
                                                placeholder="Ex. 1023498887848971H" required>
                                        </div>
                                        </div>
                                        <div class="form-group description">
                                            <label for="description">Description</label>
                                            <textarea id="description" name="description"
                                                placeholder="Ex. Portable PLC Controlled Learning System&#10;Brand: Amatrol&#10;Model: 890-757-73-DCU XXXXXXXXX"></textarea required>
                                        </div>
                                    </div>
                                    <div class="button-container">
                                        <button type="submit" class="save-button" onclick="openPopup()">Save</button>
                                        
                                        <!-- Popup for success message -->
                                        <div class="popup" id="popup">
                                            <img src="../images/check.png" alt="Check Logo">
                                            <h2>Added Successfully! </h2>
                                            <p>You have successfully saved the data!</p>
                                            <button type="button" onclick="closePopup()">Ok</button>
                                        </div>
                                        
                                        <button type="button" class="cancel-button">Cancel</button>
                                    </div>
                                    
                                    <script>
                                        let popup = document.getElementById("popup");
                                    
                                        // Function to open popup
                                        function openPopup() {
                                            popup.classList.add("open-popup");
                                        }
                                    
                                        // Function to close popup
                                        function closePopup() {
                                            popup.classList.remove("open-popup");
                                        }
                                    
                                        // Check URL for success parameter and open popup automatically
                                        const urlParams = new URLSearchParams(window.location.search);
                                        const success = urlParams.get("success");
                                    
                                        if (success === "true") {
                                            openPopup(); // Open popup when data is successfully saved
                                        }
                                    </script>
                                    
                                    <style>
                                        /* Styles for the popup */
                                        .popup {
                                            display: none;
                                            /* Additional styling for the popup */
                                        }
                                    
                                        .popup.open-popup {
                                            display: block;
                                            /* Additional styling for when the popup is visible */
                                        }
                                    </style>
                                    




                                </form>
                            </div>
                        </div>

                        <!-- PAR Preview -->
                        <div id="par-preview" style="display:none;">
                            <h2>Property Acknowledgement Receipt (PAR)</h2>
                            <table>
                                <tr>
                                    <td colspan="2">Entity Name: EASTERN SAMAR STATE UNIVERSITY</td>
                                    <td>Fund Cluster: <span id="previewFundCluster"></span></td>
                                    <td>PAR No.: <span id="previewParNo"></span></td>
                                </tr>
                                <!-- Additional rows follow -->
                            </table>
                            <button onclick="window.print()">Print</button>
                        </div>
                        </div>

                        <script>
                            function fillPreview() {
                                // Transfer form data to preview
                                document.getElementById('previewFundCluster').textContent = document.getElementById('fundCluster').value;
                                document.getElementById('previewParNo').textContent = document.getElementById('parNo').value;
                                document.getElementById('previewQuantity').textContent = document.getElementById('quantity').value;
                                document.getElementById('previewDescription').textContent = document.getElementById('description').value;
                                document.getElementById('previewPropertyNo').textContent = document.getElementById('propertyNo').value;
                                document.getElementById('previewDateAcquired').textContent = document.getElementById('dateAcquired').value;
                                document.getElementById('previewUnitValue').textContent = document.getElementById('unitValue').value;
                                document.getElementById('previewTotalAmount').textContent = document.getElementById('totalAmount').value;
                                document.getElementById('previewRemarks').textContent = document.getElementById('remarks').value;
                                document.getElementById('previewStatus').textContent = document.getElementById('status').value;
                                document.getElementById('previewStatusDate').textContent = document.getElementById('statusDate').value;
                                document.getElementById('previewInstructorOffice').textContent = document.getElementById('instructorOffice').value;
                                document.getElementById('previewAdminOfficerOffice').textContent = document.getElementById('adminOfficerOffice').value;

                                // Show the preview
                                document.getElementById('par-preview').style.display = 'block';
                            }

                            function saveForm() {
                                alert("Save functionality is not yet implemented.");
                                // Implement save logic here (e.g., send data to server)
                            }

                            function cancelForm() {
                                if (confirm("Are you sure you want to cancel? All data will be cleared.")) {
                                    document.getElementById('parForm').reset();
                                    document.getElementById('par-preview').style.display = 'none';
                                }
                            }
                        </script>


                        <script>
                            function handleSelection(selectElement) {
                                if (selectElement.value === "none") {
                                    selectElement.value = ""; // Reset the selection
                                }
                            }
                        </script>

</body>

</html>